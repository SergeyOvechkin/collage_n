<!DOCTYPE html>
<html lang="ru">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="./css/bootstrap.min.css">
<link rel="stylesheet" href="./css/collagen.css">
<style type="text/css"> 
</style>
</head>
	<body>
		<div class="container-fluid">
			<div class="row">
				<div  class="col-8" id="canvas_container">
						<div  class="canvas-container">
							<canvas data-canvas="container"  id="canvas"></canvas>
						</div>
						<div data-control_points="container" class="control-points row">
							<div class="col-md-1">
								<span name="point_x" type="text"  style="display: inline-block; width: 40px; padding: 0px; font-size: 15px; color: red;"  placeholder="x point" title="Координаты точки X на canvas"></span>
								<span name="point_y" type="text"  style="display: inline-block; width: 40px; padding: 0px;  font-size: 15px; color: red;" placeholder="y point" title="Координаты точки Y на canvas"></span>
							</div>
							<div class="col-md-1">
								<input name="control_point_x" type="text"  style="width: 60px; padding: 0px; font-size: 14px; margin-top: 2px;"  placeholder="x point" title="Координаты  X на canvas">
								<input name="control_point_y" type="text"  style="width: 60px; padding: 0px;  font-size: 14px;" placeholder="y point" title="Координаты  Y на canvas">
							</div>
							<div class="col-md-3">
								<button type="button" name="move_coner_to_point" style="width: 190px; " class="btn btn-outline-info btn-sm" title="Поместить верхний угол спрайта или контура в точку на координатах">Переместить в точку угол</button>
								<button type="button" name="move_center_to_point" style="width: 190px; " class="btn btn-outline-info btn-sm" title="Поместить центр спрайта или контура в точку на координатах">Переместить в точку центр</button>							
							</div>
							<div class="col-md-4">
								<button type="button" name="add_area_point" style="width: 190px; margin-left: 4px;" class="btn btn-outline-info btn-sm" title="Добавить точку незаконченного контура к координатам">Добавить точку к контуру</button>
								<input name="move_area_point" type="text"  style="margin-left: 4px; width: 90px; padding: 0px; font-size: 13px; position: relative; top: 2px;"  placeholder="index point" title="Переместить точку - index контура в указанные координаты">
								<button type="button" name="move_area_point_click" style="width: 90px;" class="btn btn-outline-info btn-sm" title="Переместить точку - index контура в указанные координаты">move</button>
							</div>
							<div class="col-md-3">
							   <div>текущая операция:</div>
							   <div  name="current_operation" style="background-color: green; color: white;">common</div>
							</div>							
						</div>
						<form name="form_text" style="margin-top: 20px;" onsubmit="return false" data-form_text="container" style="margin-top: 10px;">
							<p name="form_show" class="clicker" >Написать текст  <span>+</span></p>
							<div class="d-none">
								<div class="form-group form-row">
									<div class="form-group col-md-9">
										<input type="text" name="font_url"  class="form-control form-control-sm"  placeholder="font url" value="https://fonts.googleapis.com/css2?family=Balsamiq+Sans:ital,wght@0,700;1,400&family=Inconsolata&family=Josefin+Sans:wght@200&family=Srisakdi:wght@700&display=swap">	
									</div>
									<div class="form-group col-md-3">
										<button type="button" name="add_font" class="btn btn-info btn-sm">Добавить шрифт</button>
									</div>
								</div>
								<div class="alert alert-warning" role="alert">
										Загруженые cdn шрифты могут не сработать при первом клике!
								</div>
								<div class="form-group">
									<input type="text" name="font"  class="form-control form-control-sm" value="30px Balsamiq Sans"  placeholder="font param (size_px font-family from font url)">	
								</div>
								<div class="form-group form-row">
									<div class="form-group col-md-3">
											<input type="text" name="text_x"  class="form-control form-control-sm" value="100"  placeholder="x coord">	
									</div>
									<div class="form-group col-md-3">
											<input type="text" name="text_y"  class="form-control form-control-sm"  value="100"  placeholder="y coord">	
									</div>
									<div class="form-group col-md-3">
											<input type="text" name="color"  class="form-control form-control-sm"  value="green"  placeholder="color">	
									</div>
									<div class="form-group col-md-3">
											<input type="text" name="max_w"  class="form-control form-control-sm"  placeholder="max width">	
									</div>
								</div>									
								<div class="form-group">
									<textarea name="text" rows="2" cols="45" type="text"  class="form-control form-control-sm"  placeholder="text"></textarea>
								</div>
								<button type="button" name="add_text" class="btn btn-info btn-sm">Добавить текст</button>
							</div>
						</form>


				</div>
				<div class="col-4">
						    <form data-main_form="container" name="formA" onsubmit="return false" enctype="multipart/form-data" action="__URL__" method="POST" style="margin-top: 10px;">
								<div class="form-row panel_phone_img_1">
									<div class="form-group col-2">
											
											<input name="load_url_img" type="text" class="form-control form-control-sm"  placeholder="img url" title="Url картинки сервера разрешающего crossorigin запросы">
									</div>
								    <div class="form-group col-3">
										 <div class="form-group">
											<label name="load_img_click" class="inp-file" for="exampleFormControlFile1" title="Загрузить картинку с компьютера">load img</label>
											<input name="load_img" type="file" class="form-control-file form-control-sm"  id="exampleFormControlFile1">
										</div>
									</div>
									<div class="form-group col-7 col-md-7">
										<button type="button"  name="step_back" class="btn btn-success btn-sm" title="Шаг назад для преобразований фоновой картинки"><</button>
										<button type="button"  name="save_img" class="btn btn-success btn-sm" title="Сделать снимок фонового изображения">save</button>
										<button type="button"  name="restore_img" class="btn btn-warning btn-sm" title="Отобразить предыдущий снимок фонового изображения">restore</button>
										<button type="button"  name="restart_img" class="btn btn-danger btn-sm" title="Восстановить начальное изображение"><svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-arrow-clockwise" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3.17 6.706a5 5 0 0 1 7.103-3.16.5.5 0 1 0 .454-.892A6 6 0 1 0 13.455 5.5a.5.5 0 0 0-.91.417 5 5 0 1 1-9.375.789z"/><path fill-rule="evenodd" d="M8.147.146a.5.5 0 0 1 .707 0l2.5 2.5a.5.5 0 0 1 0 .708l-2.5 2.5a.5.5 0 1 1-.707-.708L10.293 3 8.147.854a.5.5 0 0 1 0-.708z"/></svg></button>
									</div>
								</div>
								<div style="margin-top: 5px; margin-bottom: 5px; ">
								<div class="form-row" style=";">
									<div class="form-group col-12">
										<label for="exampleFormControlInput1">Коэффициенты x,y масштабирования и отражение фона</label>
									</div>	
									<div class="form-group col-2">									
											<input name="img_main_scale_x" type="text" class="form-control form-control-sm"  placeholder="scale X" value="0.7" title="Коэффициент масштабирования по вертикали"> 
									</div>
									<div class="form-group col-2">								
											<input name="img_main_scale_y" type="text" class="form-control form-control-sm"  placeholder="scale Y" value="0.7" title="Коэффициент масштабирования по горизонтали">
									</div>
									
									<div class="form-group col-2"> 
										<div class="form-check">
											<input type="checkbox" name="mirror_x"  class="form-check-input" >
											<label class="form-check-label" for="exampleCheck1">flip-x</label>
										</div>	
									</div>	
									<div class="form-group col-2"> 
										<div class="form-check">
											<input type="checkbox" name="mirror_y"  class="form-check-input" >
											<label class="form-check-label" for="exampleCheck1">flip-y</label>
										</div>	
									</div>	
									<div class="form-group col-4">	
										<button type="button"  style="margin-top: 0px;" name="phone_scale_mirror" class="btn btn-primary btn-sm">Применить</button>
									</div>											
								 </div> 
								 <div class="form-row">


								</div>
								</div>
								<div class="form-group">
										<label for="exampleFormControlInput1" style="font-size: 15px;">Вращать, масштабировать выделение, спрайт.</label>
										<div class="form-row">
											<div class="form-group col-md-2">
												<input name="rotate_area" type="text" class="form-control form-control-sm"  placeholder="градус" title="Вращать спрайт или выделенную область">
											</div>	
											<div class="form-group col-md-4"> 
												<div class="form-check">
													<input type="checkbox" name="smoothing"  class="form-check-input" id="exampleCheck1" title="Включить сглаживание для вращения">
													<label class="form-check-label" for="exampleCheck1" >Сглаживание</label>
												</div>	
											</div>
											<div class="form-group col-md-6" name="scale_area_class">
												<input name="scale_x_area"  placeholder="x scale" type="text"    title="Масштабировать область выделения по оси X">
												<input name="scale_y_area"   placeholder="y scale"  type="text"   title="Масштабировать область выделения по оси Y">
												<button type="button"  name="scale_x_y" class="btn btn-success btn-sm">scale</button>
											</div>	
										</div>	
								 </div>
								<div class="form-group" name="add_rm_index_point">
									<label for="exampleFormControlInput1" style="font-size: 15px;">Добавить, удалить точку к контуру выделения.</label>
									<div class="form-row">
										<div class="form-group col-md-6">
										
											<input name="add_index_point" type="text" class="form-control form-control-sm"  placeholder="индекс точки +1" title="Добавить точку к замкнутому контуру выделения области">
										</div>
										<div class="form-group col-md-6">
										
											<input name="rm_index_point" type="text" class="form-control form-control-sm"  placeholder="индекс точки" title="Удалить точку из контура выделения области">
										</div>
									</div>
								 </div>
								 


                                 <div name="common_btns_class">
									<button type="button"  style="margin-top: 5px;" name="scale_or_move_point" class="btn btn-warning btn-sm" title="Масштабировать по точкам выделения">Искажать</button>

									<button type="button"  style="margin-top: 5px;" name="reset_area" class="btn btn-dark btn-sm">Сбросить выделение</button> 
									<button type="button" style="margin-top: 5px;" name="create_sprite" class="btn btn-success btn-sm">Создать Sprite</button>
								 </div> 
								
								  <button type="button"  style="margin-top: 5px;" name="mirror_x_area" class="btn btn-primary btn-sm" title="Отразить выделенную область по горизонтали">flip x</button>
								  <button type="button"  style="margin-top: 5px;" name="mirror_y_area" class="btn btn-primary btn-sm" title="Отразить выделенную область по вертикали">flip y</button>
								  
								  <button type="button"  style="margin-top: 5px;" name="clear_phone" class="btn btn-secondary btn-sm" title="Установить прозрачность фона = 0">Очистить фон</button>
								  <button type="button"  style="margin-top: 5px;" name="operation_with" class="btn btn-primary btn-sm d-none">Работать с фоновым изображением</button> 		
							</form>	
							<ul data-sprites="array" class="list-group" style="margin-top: 10px; margin-bottom: 10px; max-height: 300px; overflow: auto;">
							<div  class="sprites-settings">
								<input type="checkbox" name="show_box" checked  title="Показать граници спрайта">
								<label class="form-check-label"  for="exampleCheck1" >show box</label>	
							    <input type="checkbox" name="show_points"  title="Показать точки контура">
								<label class="form-check-label" for="exampleCheck1" >show points</label>
							</div>
							<div class="sprites">	
								<li data-sprite="template" class="list-group-item">
									<!--<span name="id"></span>-->
									<input name="id" type="text"  placeholder="" title="Изменить id спрайта">
									<button type="button" name="rm_sprite" class="btn btn-danger btn-sm">Удалить</button>
									<button type="button" name="show_sprite" class="btn btn-secondary btn-sm">Скрыть</button>
									<button type="button" name="layer_up" class="btn btn-info btn-sm" title="Поднять спрайт на верхний слой">Слой up</button>
									<button type="button" name="stamp" class="btn btn-secondary btn-sm" title="Сделать отпечаток спрайта на фоновом изображении">Штамп</button>
									<button type="button" name="copy_contur" class="btn btn-warning btn-sm" title="Скоприровать контур спрайта на фоную картинку">Copy contur</button>
									<button type="button" name="stamp_cursor" class="btn btn-secondary btn-sm" title="Сделать отпечаток спрайта на фоновом изображении с помощью курсора мыши">Штамп курсор</button>
									<button type="button" name="save_sprite" class="btn  btn-success btn-sm" title="Сохранить спрайт на компьютере в локальном хранилище">Save on PC</button>
									
								</li>
							</div>	
							</ul>
							
							<form name="form_effects" onsubmit="return false" data-form_effects="container" style="margin-top: 10px;">
								<div class="form-row">
									<div class="form-group col-md-3">
											<input type="text" name="color_r"  class="form-control form-control-sm"  placeholder="Red 0-255">	
									</div>
									<div class="form-group col-md-3">
											<input type="text" name="color_g"  class="form-control form-control-sm"  placeholder="Green 0-255">	
									</div>
									
									<div class="form-group col-md-3"> 										  
											<input type="text" name="color_b" class="form-control form-control-sm"  placeholder="Blue 0-255">																					
									</div>	
									<div class="form-group col-md-3"> 
											<input type="text" name="color_a"  class="form-control form-control-sm"  placeholder="Opacity 0-255">
									</div>						
								 </div> 
								 <div class="form-row">
									<div class="form-group col-md-8">
										<label for="exampleFormControlInput1">Цвет пикселя либо формула (+=n, -=n, /=n, *=n)</label>
									</div>	
									<div class="form-group col-md-4">	
										<button type="button"  style="margin-top: 5px;" name="rgba_effect" class="btn btn-primary btn-sm" title="Применить ко всем свойствам или к некоторым (оставить поля пустыми)">Применить к выделению</button>
									</div>	
								</div>
							<p name="form_show" class="clicker" style="margin-top: 10px;">Применить функцию  <span>+</span></p>
							<div class="d-none">
								<div class="form-row" style="margin-bottom: 10px;">
										<label for="exampleFormControlInput1">Формула для обработки пикселя R,G,B,A,X,Y,W,H,TMP</label>
										<textarea name="function_to_pixels" rows="5" cols="45" type="text" class="form-control form-control-sm"  placeholder="R - red, G - green, B - blue, A - opacity, X - индекс текущего пикселя по ширине, Y - индекс текущего пикселя по высоте, W - общая ширина, H - высота, TMP - объект для хранения временных данных между итерациями цикла;

пример - покрасить черный в красный:        
if(R+G+B < 70){   R=255; }

пример TMP:    
if(TMP.num == undefined){
    TMP.num = 0; 
 } else {  
   TMP.num +=1;  
   if(TMP.num > 7000) 
   R +=155;
}"></textarea>
	
										<button type="button"  style="margin-top: 5px;" name="function_to_pixels_click" class="btn btn-primary btn-sm">Применить формулу</button>
								</div>
								<div class="form-row" style="margin-bottom: 10px;">
										<label for="exampleFormControlInput1">Формула для создания контура</label>
										<textarea name="function_to_contur" rows="5" cols="45" type="text" class="form-control form-control-sm" 
											placeholder="Формула для создания контура: area - массив с точками в формате [ [x1,y1], [x2,y2],... ] 

Пример - нарисовать контур в форме квадрата:
area = [ [10,10], [10,200], [200, 200], [200, 10]];


Пример использовать функцию модуля для рисования звезды:
(сперва нужно загрузить модуль)

area = modules.drawStar(200, 200, 4, 70, 30);
"></textarea>
										<button type="button"  style="margin-top: 5px;" name="function_to_contur_click" class="btn btn-primary btn-sm">Создать контур</button>
								</div>
							</div>	
							</form>							
							<div data-save_sprites="array">
								<button  type="button" name="load_save_sprites" class="btn btn-info btn-sm">Показать сохраненные спрайты</button>
								<ul  class="list-group" style="max-height: 300px; overflow: auto; margin-top: 10px; ">
									<li data-save_sprite="template" class="list-group-item" >
										<span name="id"></span>
										<button type="button" name="create_save_sprite" class="btn btn-primary btn-sm">Создать</button>
										<button type="button" name="rm_save_sprite" class="btn btn-danger btn-sm">Удалить</button>
										<input type="checkbox" name="to_beginning_coordinats"  title="Отобразить в начале координат">
										<label class="form-check-label" for="exampleCheck1" >top left</label>										
									</li>
								</ul>						
							</div>

				</div>
				
						<form class="col-12" name="form_load_module" style="margin-top: 0px;" onsubmit="return false" data-form_load_module="container" style="margin-top: 10px;">
                    		
							<p name="form_show" class="clicker" >Загрузить модуль <span>+</span></p>

							<div class="d-none">
							    <div class="form-group form-row ">
									<div class="form-group col-2">
										<input type="text" name="setting_name"  class="form-control form-control-sm"  placeholder="module name" value="drawCircle">	
									</div>
									<div class="form-group col-6">
										<input type="text" name="module_url"  class="form-control form-control-sm"  placeholder="module url" value="https://sergeyovechkin.github.io/collagen_modules/addDrawCirclePanel.js">	
									</div>
									<div class="form-group col-4">
										<button type="button" name="load_module" class="btn btn-info btn-sm">Загрузить модуль</button>										
										<button type="button" name="setting_add" class="btn btn-info btn-sm">В автозагрузку</button>
										<button type="button" name="setting_remove" class="btn btn-info btn-sm">Удалить</button>
									</div>
								</div>
								<div class="alert alert-info" role="alert">
								   <ul>
								    <li>Модулями можно расширять стандартный набор функций приложения. В примере выше подключается модуль рисования окружностей кликом мыши.</li>
									<li>Также функции модулей можно использовать для обработки пикселей либо создания контура.</li>
									<li>"./js/modules/drawStar.js" - функция для создания контура в форме звезы: area = modules.drawStar(200,200, 4,70,30);</li>
									<li>В настройках можно сохранить модуль для автоматичкской загрузки при старте приложения, для этого нужно ввести имя модуля и его url.</li>
									<li>Удалить модуль из автозагрузки можно по его именни введенном при создании настройки, имена всех автозагружаемых модулей можно посмотреть в консоли.</li>
								   </ul>
								</div>
							</div>
							</p>	
						</form>
			</div><!--row-->
		</div>
		
		
 
		
	   
	   <script src="./js/htmlix.js"></script>
	   <script src="./js/sprites.js"></script>
	   <script src="./js/functions.js"></script>
	    <script src="./js/functions_new.js"></script> 
	   <script src="./js/interface.js"></script>
	     <script src="./js/main.js"></script>

    </body>
	
</html>